---
title: 管理群集橫向擴展（橫向擴展），以匹配 Azure 資料資源管理器中的需求
description: 本文介紹根據不斷變化的需求在 Azure 資料資源管理器群集中橫向擴展和擴展的步驟。
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 12/09/2019
ms.openlocfilehash: ff7420619cffc2287ab8ff6332df605d56329549
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "77664128"
---
# <a name="manage-cluster-horizontal-scaling-scale-out-in-azure-data-explorer-to-accommodate-changing-demand"></a>在 Azure 資料資源管理器中管理群集橫向擴展（橫向擴展），以適應不斷變化的需求

適當調整叢集的大小對 Azure 資料總管的效能來說非常重要。 靜態叢集大小可能導致使用量過低或使用量過高，兩者皆不理想。 由於無法絕對準確地預測群集的需求，因此最好*擴展*群集，隨需求變化添加和刪除容量和 CPU 資源。 

有兩個工作流用於縮放 Azure 資料資源管理器群集： 
* 水準縮放，也稱為向上和向外縮放。
* [垂直縮放](manage-cluster-vertical-scaling.md)，也稱為向上和向下縮放。
本文介紹了水準縮放工作流。

## <a name="configure-horizontal-scaling"></a>配置水準縮放

通過使用水準縮放，您可以根據預定義的規則和計畫自動縮放實例計數。 要指定群集的自動縮放設置，請執行以下操作：

1. 在 Azure 門戶中，轉到 Azure 資料資源管理器群集資源。 在 **"設置"** 下，選擇 **"橫向縮小**"。 

2. 在 **"橫向擴展"** 視窗中，選擇所需的自動縮放方法：**手動縮放**、**優化自動縮放**或**自訂自動縮放**。

### <a name="manual-scale"></a>手動調整

手動縮放是群集創建期間的預設設置。 群集具有不會自動更改的靜態容量。 您可以使用**實例計數**欄選擇靜態容量。 群集的縮放將保持該設置，直到您進行另一個更改。

   ![手動縮放方法](media/manage-cluster-horizontal-scaling/manual-scale-method.png)

### <a name="optimized-autoscale-preview"></a>優化自動縮放（預覽）

優化自動縮放是推薦的自動縮放方法。 此方法優化群集性能和成本。 如果群集接近利用率不足的狀態，則將放大該群集。 此操作可降低成本，但保持性能水準。 如果群集接近過度使用狀態，則將其橫向擴展以保持最佳性能。 要配置優化自動縮放：

1. 選擇 **"優化自動縮放**"。 

1. 選擇最小實例計數和最大實例計數。 基於負載的群集在這兩個數字之間自動縮放範圍。

1. 選取 [儲存]****。

   ![優化自動縮放方法](media/manage-cluster-horizontal-scaling/optimized-autoscale-method.png)

優化的自動縮放開始工作。 其操作現在在群集的 Azure 活動日誌中可見。

#### <a name="logic-of-optimized-autoscale"></a>優化自動縮放的邏輯 

**橫向擴展**

當群集接近過度使用狀態時，橫向擴展以保持最佳性能。 在：
* 群集實例數低於使用者定義的最大實例數。
* 緩存利用率高達一個多小時。
* CPU 高一個多小時。
* 攝入利用率高達一個多小時。

> [!NOTE]
> 橫向擴展邏輯當前不考慮引入利用率指標。 如果此指標對用例很重要，請使用[自訂自動縮放](#custom-autoscale)。

**相應縮小**

當群集接近利用率不足的狀態時，請擴展以降低成本但保持性能。 多個指標用於驗證在群集中擴展是否安全。 執行比例之前每小時計算 6 小時以下規則：
* 實例數高於 2，高於定義的最小實例數。
* 為確保資源不會超載，必須在執行規模之前驗證以下指標： 
    * 緩存利用率不高
    * CPU 低於平均值 
    * 攝入利用率低於平均水準 
    * 流式處理利用率（如果使用流式處理）不高
    * 保持活動事件高於定義的最小值，處理正確，並按時處理。
    * 無查詢限制 
    * 失敗查詢的數量低於定義的最小值。

> [!NOTE]
> 邏輯中的比例當前需要 7 天的評估，然後才能實施優化的刻度。 此評估每 24 小時進行一次。 如果需要快速更改，請使用[手動縮放](#manual-scale)。

### <a name="custom-autoscale"></a>自訂自動縮放

通過使用自訂自動縮放，可以根據指定的指標動態縮放群集。 下圖顯示了配置自訂自動縮放的流和步驟。 更多詳細資訊請關注圖形。

1. 在 **"自動縮放"設置名稱**框中，輸入名稱，如*橫向擴展：緩存利用率*。 

   ![調整規則](media/manage-cluster-horizontal-scaling/custom-autoscale-method.png)

2. 對於 **"縮放"模式**，選擇**基於指標的縮放**。 此模式提供動態縮放。 您還可以選擇 **"縮放"到特定實例計數**。

3. 選擇 **= 添加規則**。

4. 在右側的 **"縮放規則"** 部分中，輸入每個設置的值。

    **標準**

    | 設定 | 描述和值 |
    | --- | --- |
    | **時間聚合** | 選取彙總準則，例如 [平均]****。 |
    | **度量名稱** | 選取調整大小作業依據的計量，例如 [快取使用率]****。 |
    | **時間粒紋統計資料** | 選擇 [平均]****、[最小值]****、[最大值]****，或 [加總]****。 |
    | **運算元** | 選擇適當的選項，例如 [大於或等於]****。 |
    | **閾 值** | 選擇適當的值。 例如，對於緩存利用率，80% 是一個很好的起點。 |
    | **持續時間（以分鐘）** | 選擇適當的時間長度，讓系統在計算計量時有所依據。 從預設的 10 分鐘開始。 |
    |  |  |

    **動作**

    | 設定 | 描述和值 |
    | --- | --- |
    | **操作** | 選擇相應縮小或相應放大的適當選項。 |
    | **實例計數** | 選擇滿足計量條件時，您欲新增或移除的節點或執行個體數。 |
    | **冷卻（分鐘）** | 選擇調整大小作業間適當的時間間隔。 請從預設的五分鐘開始。 |
    |  |  |

5. 選取 [加入]****。

6. 在左側的 **"實例限制"** 部分中，輸入每個設置的值。

    | 設定 | 描述和值 |
    | --- | --- |
    | **最低** | 執行個體數；無論使用率為何，您的叢集都不會調整到低於此數值。 |
    | **最大** | 執行個體數；無論使用率為何，您的叢集都不會調整到高於此數值。 |
    | **預設** | 實例的預設數量。 如果在讀取資源指標時出現問題，則使用此設置。 |
    |  |  |

7. 選取 [儲存]****。

現在，您已為 Azure 資料資源管理器群集配置了水準縮放。 添加另一條垂直縮放規則。 如果需要有關群集縮放問題的説明，請在 Azure 門戶中[打開支援請求](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview)。

## <a name="next-steps"></a>後續步驟

* [使用指標監視 Azure 資料資源管理器的性能、運行狀況和使用](using-metrics.md)
* [管理群集垂直縮放](manage-cluster-vertical-scaling.md)，以調整群集的適當大小。

---
title: 在 Azure 監視器中建立具有動態閾值的警示
description: 建立警示，內含以機器學習為基礎的動態閾值
author: yanivlavi
ms.author: yalavi
ms.topic: conceptual
ms.date: 02/16/2020
ms.openlocfilehash: 110d4a3219b4898fa6f138e29f1112d7134f674c
ms.sourcegitcommit: f88074c00f13bcb52eaa5416c61adc1259826ce7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/21/2020
ms.locfileid: "92340082"
---
# <a name="metric-alerts-with-dynamic-thresholds-in-azure-monitor"></a>Azure 監視器中有動態閾值的計量警示

「具有動態閾值的計量警示」偵測會利用進階的機器學習 (ML) 來學習計量的歷史行為，以及識別模式和可能表示服務有問題的異常狀況。 它可讓使用者以完全自動化的方式透過 Azure Resource Manager API 設定警示規則，因此對於簡單的 UI 和大規模作業均提供支援。

警示規則建立後，只有在受監視的計量未依預期運作 (依據其專用的閾值) 時，才會引發。

我們很希望聽聽您的意見反應，來信請寄到 <azurealertsfeedback@microsoft.com>。

## <a name="why-and-when-is-using-dynamic-condition-type-recommended"></a>建議使用動態條件類型的原因和時機為何？

1. **可** 調整的警示–動態閾值警示規則一次可以為數百個計量系列建立量身打造的閾值，但提供對單一度量定義警示規則的相同便利性。 它們提供您較少的警示來建立和管理。 您可以使用 Azure 入口網站或 Azure Resource Manager API 來建立它們。 在處理計量維度或套用至多個資源（例如所有訂用帳戶資源）時，可調整的方法特別有用。  [深入了解如何使用範本設定具有動態閾值的計量警示](alerts-metric-create-templates.md)。

1. **智慧型計量模式** 辨識–使用我們的 ML 技術，我們可以自動偵測計量模式，並隨著時間調整計量變更，這些變更通常可能包括季節性 (每小時/每日/每週) 。 隨著時間調整度量的行為，並根據其模式的偏差，免除了知道每個度量「正確」閾值的負擔。 動態閾值中使用的 ML 演算法可防止不具備預期模式的雜訊 (低精確度) 或廣泛 (低召回率) 閾值。

1. **直覺** 設定–動態閾值可讓您使用高階概念來設定計量警示，而不需要對度量具有廣泛的領域知識。

## <a name="how-to-configure-alerts-rules-with-dynamic-thresholds"></a>如何設定具有動態閾值的警示規則？

具有動態閾值的警示可透過 Azure 監視器中的計量警示來設定。 [深入了解如何設定計量警示](alerts-metric.md)。

## <a name="how-are-the-thresholds-calculated"></a>閾值的計算方式為何？

「動態閾值」會持續學習計量序列的資料，並嘗試使用一組演算法和方法來建立其模型。 它會偵測資料中的模式 (例如每小時/每天/每週之類的季節性)，並且能夠處理雜訊計量 (例如電腦 CPU 或記憶體) 以及具有低離散程度的計量 (例如可用性和錯誤率)。

選取閾值的方式，是偏離這些閾值的程度必須表示計量行為出現異常。

> [!NOTE]
> 季節性模式偵測設定為小時、天或周間隔。 這表示可能不會偵測到 bihourly 模式或 semiweekly 之類的其他模式。

## <a name="what-does-sensitivity-setting-in-dynamic-thresholds-mean"></a>動態閾值中的「敏感度」設定有何意義？

警示閾值敏感度是一項基本概念，可控制須偏離計量行為達何種程度才會觸發警示。
此選項不像靜態閾值那麼需要計量領域相關知識。 可用的選項如下︰

- 高 – 閾值會嚴格且接近計量序列模式。 系統會在最小偏差上觸發警示規則，進而產生更多警示。
- 中 – 較不嚴格而較為中庸的閾值，產生的警示會比高敏感度少 (預設值)。
- 低 – 閾值會寬鬆且偏離計量序列模式較遠。 警示規則只會在發生大量偏差時觸發，而產生較少的警示。

## <a name="what-are-the-operator-setting-options-in-dynamic-thresholds"></a>動態閾值中有哪些「運算子」設定選項？

動態閾值警示規則可根據計量行為，針對使用相同警示規則的上限和下限建立自訂的閾值。
您可以選擇在符合下列三個條件之一時觸發警示：

- 大於閾值上限或低於閾值下限 (預設值)
- 大於閾值上限
- 低於閾值下限。

## <a name="what-do-the-advanced-settings-in-dynamic-thresholds-mean"></a>動態閾值中的進階設定有何意義？

**失敗的期間** -動態閾值也可讓您設定「觸發警示的次數違規」、系統引發警示的特定時間範圍內所需的最小偏差數目 (預設時間範圍是20分鐘的四次偏差) 。 使用者可以設定失敗期間，並藉由變更失敗期間和時間範圍來選擇要警示的標的。 這項功能可減少暫時性尖峰所產生的警示雜訊。 例如：

若要在問題持續 20 分鐘、在 5 分鐘的指定期間分組內連續發生 4 次時觸發警示，請使用下列設定：

![問題持續 20 分鐘、在 5 分鐘的指定期間分組內連續發生 4 次的失敗期間設定](media/alerts-dynamic-thresholds/0008.png)

若要以 5 分鐘為期間，在過去 30 分鐘內有 20 分鐘發生違反動態閾值的情況時觸發警示，請使用下列設定：

![以 5 分鐘為期間分組，在過去 30 分鐘內有 20 分鐘發生問題的失敗期間設定](media/alerts-dynamic-thresholds/0009.png)

**忽略資料 (以下時間之前)** - 使用者也可以選擇性地定義系統應開始計算閾值的開始日期。 如果資源先前執行於測試模式中，而現已升級供生產工作負載之用，因此應忽略任何計量在測試階段的行為，就可能會發生常見的使用案例。

## <a name="how-do-you-find-out-why-a-dynamic-thresholds-alert-was-triggered"></a>如何得知動態閾值警示的觸發原因？

您可以按一下電子郵件或文字訊息中的連結，或瀏覽器查看 Azure 入口網站中的 [警示]，以在 [警示] 視圖中探索觸發的警示實例。 [深入瞭解警示的觀點](alerts-overview.md#alerts-experience)。

警示視圖會顯示：

- 當動態閾值警示引發時的所有計量詳細資料。
- 觸發警示的期間圖表，其中包含該時間點所使用的動態閾值。
- 能夠提供動態閾值警示的意見反應，以及警示視圖體驗，進而改善未來的偵測結果。

## <a name="will-slow-behavior-changes-in-the-metric-trigger-an-alert"></a>計量中的行為變更會降低警示嗎？

大概沒有。 動態閾值適合用於偵測明顯的偏差，而不是緩慢發展的問題。

## <a name="how-much-data-is-used-to-preview-and-then-calculate-thresholds"></a>會有多少資料用來預覽並計算閾值？

當您第一次建立警示規則時，系統會根據足夠的歷程記錄資料來計算出現在圖表中的臨界值，以計算每小時或每日季節性模式 (10 天) 。 一旦建立警示規則，動態閾值會使用所有所需的可用歷程記錄資料，並根據新資料持續學習及調整，讓閾值更準確。 這表示在此計算之後，圖表也會顯示每週模式。

## <a name="how-much-data-is-needed-to-trigger-an-alert"></a>觸發警示需要多少資料？

如果您有新的資源或遺失的計量資料，動態閾值將不會在三天前觸發警示，而且至少有30個可用的度量資料樣本可供使用，以確保正確的閾值。
對於具有足夠度量資料的現有資源，動態閾值可以立即觸發警示。

## <a name="dynamic-thresholds-best-practices"></a>動態閾值最佳做法

動態閾值可以在 Azure 監視器中套用至大部分的平臺和自訂計量，而且也會針對常見的應用程式和基礎結構計量進行調整。
下列項目是有關如何使用「動態閾值」來設定這其中一些計量相關警示的最佳做法。

### <a name="dynamic-thresholds-on-virtual-machine-cpu-percentage-metrics"></a>虛擬機器 CPU 百分比計量的相關動態閾值

1. 在 [Azure 入口網站](https://portal.azure.com)中，按一下 [ **監視**]。 [監視] 檢視會將您的所有監視設定與資料合併在一個檢視中。

2. 按一下 [警示]****，然後按一下 [+ 新增警示規則]****。

    > [!TIP]
    > 大部分的資源刀鋒視窗也都有 [警示]**** (位於 [監視]**** 下的資源功能表)，您也可以從該處建立警示。

3. 在載入的內容窗格中，按一下 [選取目標]****，選取您要發出警示的目標資源。 請使用 [訂用帳戶]**** 與 ['虛擬機器' 資源類型]**** 下拉式清單來尋找您想要監視的資源。 您也可以使用搜尋列來尋找您的資源。

4. 選取目標資源之後，請按一下 [新增準則]****。

5. 選取 [CPU 百分比]****。

6. (選擇性) 藉由調整 [期限]**** 和 [彙總]**** 來精簡計量。 針對此計量類型，不建議使用 [最大值] 彙總類型，因為它比較無法代表行為。 就 [最大值] 彙總類型而言，靜態閾值可能較為適當。

7. 您會看到過去 6 小時的計量圖表。 定義警示參數：
    1. **條件類型** - 選擇 [動態] 選項。
    1. **敏感度** - 選擇 [中]/[低] 敏感度以減少警示干擾。
    1. **運算子** - 除非行為代表應用程式使用量，否則請選擇 [大於]。
    1. **頻率** - 請考慮根據警示的業務影響降低頻率。
    1. **失敗期間** (進階選項) - 回顧時間範圍應該至少為 15 分鐘。 例如，如果期間設定為 5 分鐘，則失敗期間應該至少為 3 個以上。

8. 計量圖表會顯示以最近資料為基礎的計算臨界值。

9. 按一下 [完成]  。

10. 填寫 [警示詳細資料]****，例如 [警示規則名稱]****、[描述]**** 及 [嚴重性]****。

11. 透過選取現有動作群組或建立新的動作群組，將動作群組新增至警示。

12. 按一下 [完成]**** 以儲存計量警示規則。

> [!NOTE]
> 透過入口網站建立的計量警示規則，會在與目標資源相同的資源群組中建立。

### <a name="dynamic-thresholds-on-application-insights-http-request-execution-time"></a>Application Insights HTTP 要求執行時間的相關動態閾值

1. 在 [Azure 入口網站](https://portal.azure.com)中，按一下 [ **監視**]。 [監視] 檢視會將您的所有監視設定與資料合併在一個檢視中。

2. 按一下 [警示]****，然後按一下 [+ 新增警示規則]****。

    > [!TIP]
    > 大部分的資源刀鋒視窗也都有 [警示]**** (位於 [監視]**** 下的資源功能表)，您也可以從該處建立警示。

3. 在載入的內容窗格中，按一下 [選取目標]****，選取您要發出警示的目標資源。 使用 [訂用帳戶]**** 和 ['Application Insights' 資源類型]**** 下拉式清單來尋找您想要監視的資源。 您也可以使用搜尋列來尋找您的資源。

4. 選取目標資源之後，請按一下 [新增準則]****。

5. 選取 [HTTP 要求執行時間]****。

6. (選擇性) 藉由調整 [期限]**** 和 [彙總]**** 來精簡計量。 針對此計量類型，不建議使用 [最大值] 彙總類型，因為它比較無法代表行為。 就 [最大值] 彙總類型而言，靜態閾值可能較為適當。

7. 您會看到過去 6 小時的計量圖表。 定義警示參數：
    1. **條件類型** - 選擇 [動態] 選項。
    1. **運算子** - 選擇 [大於] 以減少在持續期間內針對改善而引發的警示。
    1. **頻率** - 請考慮根據警示的業務影響降低頻率。

8. 計量圖表會顯示以最近資料為基礎的計算臨界值。

9. 按一下 [完成]  。

10. 填寫 [警示詳細資料]****，例如 [警示規則名稱]****、[描述]**** 及 [嚴重性]****。

11. 透過選取現有動作群組或建立新的動作群組，將動作群組新增至警示。

12. 按一下 [完成]**** 以儲存計量警示規則。

> [!NOTE]
> 透過入口網站建立的計量警示規則，會在與目標資源相同的資源群組中建立。

## <a name="interpreting-dynamic-threshold-charts"></a>解讀動態閾值圖表

以下圖表顯示度量、其動態閾值限制，以及當值超出允許的閾值時，所引發的一些警示。

![深入瞭解如何設定計量警示](media/alerts-dynamic-thresholds/threshold-picture-8bit.png)

使用下列資訊來解讀先前的圖表。

- **藍線** -一段時間的實際測量度量。
- **藍色陰影區域** -顯示度量允許的範圍。 只要計量值維持在此範圍內，就不會產生任何警示。
- **藍色點** -如果您按一下圖表的一部分，然後將滑鼠停留在藍線上，您會在游標下方看到一個藍色點，顯示個別匯總的計量值。
- **具有藍色點** 的快顯-顯示已測量的度量值 (藍色點) ，以及允許範圍的上限和下限值。  
- **具有黑色圓形的紅點** -顯示所允許範圍內的第一個度量值。 這是引發計量警示，並將其置於作用中狀態的值。
- **紅點**-指出超出允許範圍的額外測量值。 它們不會引發其他計量警示，但警示會保持在作用中狀態。
- **紅色區域** -顯示度量值超出允許範圍的時間。 只要後續測量的值超出允許的範圍，警示就會保持作用中狀態，但不會引發任何新的警示。
- **紅色區域結尾** -當藍線回到允許的值內部時，紅色區域會停止，且測量的值線會變成藍色。 當紅點出現黑色外框時，所引發的計量警示狀態會設定為 [已解決]。 
